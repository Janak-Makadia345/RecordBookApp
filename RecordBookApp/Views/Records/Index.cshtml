@model IEnumerable<RecordBookApp.Models.Record>

@{
    ViewData["Title"] = "Index";
    int counter = 1;
    string selectedType = TempData["selectedType"] as string ?? ""; // Use TempData for selected button type
}

<script type="text/javascript">
    function toggleRowExpansion(event) {
        const clickedElement = event.target;
        const hasAction = clickedElement.classList.contains('asp-action') || clickedElement.parentElement?.classList.contains('asp-action');

        if (hasAction) {
            // Prevent default behavior if anchor tag with asp-action is clicked
            event.preventDefault();
        } else {
            // Toggle row expansion otherwise
            clickedElement.parentElement.classList.toggle('expanded');
        }
    }

    function handleButtonClick(buttonType) {
        // Redirect to Create action with buttonType parameter
        window.location.href = "/Records/Create?buttonClicked=" + buttonType;
    }
</script>

<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h1">Your Records</h1>
        <div class="d-flex">
            <a href="#" class="btn btn-success me-2" onclick="handleButtonClick('cashin')">Cash In</a>
            <a href="#" class="btn btn-danger" onclick="handleButtonClick('cashout')">Cash Out</a>
        </div>
    </div>

    <div class="row justify-content-center mb-3">
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Total Cash In</h5>
                    <p class="card-text">@ViewBag.TotalCashIn</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body">
                    <h5 class="card-title">Total Cash Out</h5>
                    <p class="card-text">@ViewBag.TotalCashOut</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-navy">
                <div class="card-body">
                    <h5 class="card-title">Net Balance</h5>
                    <p class="card-text">@ViewBag.NetBalance</p>
                </div>
            </div>
        </div>
    </div>

    <form id="createRecordForm" asp-action="Create">
        <input type="hidden" id="selectedTypeInput" name="buttonClicked" value="@selectedType">
    </form>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">No.</th>
                <th scope="col">Date</th>
                <th scope="col">Time</th>
                <th scope="col">Amount</th>
                <th scope="col">Category</th>
                <th scope="col">Payment</th>
                <th scope="col">File</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr class="expandable-row">
                    <td>@counter</td>
                    <td>@item.Date.ToString("yyyy-MM-dd")</td>
                    <td>@item.Time.ToString("HH:mm")</td>
                    <td style="color: @((item.Category.Type.ToLower() == "cashin") ? "green" : "red")">@item.Amount</td>
                    <td>@Html.DisplayFor(modelItem => item.Category.Name)</td>
                    <td>@Html.DisplayFor(modelItem => item.Payment.Type)</td>
                    <td>
                        @if (!string.IsNullOrEmpty(item.FileName))
                        {
                            if (item.FileName.EndsWith(".pdf"))
                            {
                                <a href="@Url.Action("Preview", new { id = item.RecordId })">
                                    <i class="bi bi-file-earmark-pdf"></i>
                                </a>
                            }
                            else if (item.FileName.EndsWith(".jpg") || item.FileName.EndsWith(".jpeg") || item.FileName.EndsWith(".png"))
                            {
                                <a href="@Url.Action("Preview", new { id = item.RecordId })">
                                    <i class="bi bi-image"></i>
                                </a>
                            }
                            else
                            {
                                <span>Unsupported file type</span>
                            }
                        }
                    </td>
                    <td>
                        <a asp-action="Edit" asp-route-id="@item.RecordId" class="btn btn-sm btn-light">Edit</a>
                        <a asp-action="Delete" asp-route-id="@item.RecordId" class="btn btn-sm btn-light">Delete</a>
                    </td>
                </tr>
                counter++;
            }
        </tbody>
    </table>
</div>

<style>
    .bg-navy {
        background-color: #001f3f !important;
    }

    .card {
        width: 100%;
    }

    .row.justify-content-center {
        text-align: center;
    }
</style>
